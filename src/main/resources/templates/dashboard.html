<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Client Tickets</title>
    <script>
        // Function to fetch tickets by client ID
        function fetchTickets() {
            const clientId = document.getElementById("clientIdInput").value; // Get client ID from input field

            if (!clientId) {
                alert("Please enter a client ID.");
                return;
            }

            fetch(`/api/tickets/getAllTickets/${clientId}`)
                .then(response => response.json())
                .then(tickets => {
                    let ticketsList = document.getElementById("tickets-list");
                    ticketsList.innerHTML = "";  // Clear previous tickets

                    if (tickets.length > 0) {
                        tickets.forEach(ticket => {
                            let ticketElement = document.createElement("li");
                            ticketElement.textContent = `Ticket ID: ${ticket.id} - Price: ${ticket.price}`;
                            ticketsList.appendChild(ticketElement);
                        });
                    } else {
                        ticketsList.innerHTML = "No tickets found for this client.";
                    }
                })
                .catch(error => {
                    console.error("Error fetching tickets:", error);
                });
        }

        // Function to submit new ticket data to the backend
        function submitTicketForm() {
            const clientId = document.getElementById("clientId").value; // Get client ID from the form

            // Fetch client by ID
            fetch(`/api/clients/${clientId}`)
                .then(response => response.json())
                .then(client => {
                    if (client) {
                        const ticketData = {
                            concertHall: document.getElementById("concertHall").value,
                            eventCode: document.getElementById("eventCode").value,
                            isPromo: document.getElementById("isPromo").checked,
                            stadiumSector: document.getElementById("stadiumSector").value,
                            maxBackpackWeight: document.getElementById("maxBackpackWeight").value,
                            price: document.getElementById("price").value,
                            client: client // Add client to the ticket object
                        };

                        // Send POST request to save the ticket
                        fetch('/api/tickets', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(ticketData)
                        })
                        .then(response => response.json())
                        .then(ticket => {
                            alert('Ticket saved successfully!');
                            console.log(ticket);  // Log the saved ticket
                        })
                        .catch(error => {
                            console.error("Error saving ticket:", error);
                            alert('Error saving ticket!');
                        });
                    } else {
                        alert('Client not found!');
                    }
                })
                .catch(error => {
                    console.error("Error fetching client:", error);
                    alert('Error fetching client!');
                });
        }
    </script>
</head>
<body>

<h1>ðŸŽ‰ðŸŽ‰ðŸŽ‰</h1>

<!-- Input field for client ID and button to fetch tickets -->
<label for="clientIdInput">Client ID:</label>
<input type="number" id="clientIdInput" required>
<button onclick="fetchTickets()">Get Client's Tickets</button>

<div>
    <h2>Client Tickets:</h2>
    <ul id="tickets-list">
        <!-- Tickets will be dynamically added here -->
    </ul>
</div>

<!-- Form to submit a new ticket -->
<h2>Save New Ticket:</h2>
<form id="ticketForm" onsubmit="event.preventDefault(); submitTicketForm();">
    <label for="concertHall">Concert Hall:</label>
    <input type="text" id="concertHall" required><br>

    <label for="eventCode">Event Code (100-999):</label>
    <input type="number" id="eventCode" min="100" max="999" required><br>

    <label for="isPromo">Is Promo:</label>
    <input type="checkbox" id="isPromo"><br>

    <label for="stadiumSector">Stadium Sector:</label>
    <input type="text" id="stadiumSector" required><br>

    <label for="maxBackpackWeight">Max Backpack Weight:</label>
    <input type="number" id="maxBackpackWeight" min="0.1" step="0.1" required><br>

    <label for="price">Price:</label>
    <input type="number" id="price" min="0.1" step="0.1" required><br>

    <label for="clientId">Client ID:</label>
    <input type="number" id="clientId" required><br>

    <button type="submit">Save Ticket</button>
</form>

</body>
</html>
